<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8"/>
    <style>
        svg {
            border-color: grey;
            border-width: 2px;
            border-style: solid;
        }
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
        d3.select(window).on('load',init);
        
        function create_hand_coords(hand_csv, keys){
                
                hand_lol = []
                n_of_points = 56//Math.floor(keys.length / 2)
                for (i=0; i< n_of_points; i++){
                        j = i + n_of_points;
                        px = parseFloat(hand_csv[keys[i]])
                        py = parseFloat(hand_csv[keys[j]])
                        hand_lol.push([px,py])
                    }
                 
                return hand_lol;
        }
        
        function zip(arrays) {
            return arrays[0].map(function(_,i){
                return arrays.map(function(array){return array[i]})
            });
        }
        
        
        function create_keys(){
            keys_string = ""
            n_of_points= 56
            start_ascii_code = 97
            alphabet_codes = 26
            code_add = 0
            key_length = 1
            for (i=0; i < n_of_points*2; i++){
                key = (String.fromCharCode(start_ascii_code + code_add)).repeat(key_length)
                code_add = code_add + 1
                if (code_add == 25){
                    code_add = 0
                    key_length = key_length + 1
                }
                if (keys_string != "") {
                    keys_string += ","
                }               
                keys_string += key
            }
            keys_string = keys_string + "\n"
            return keys_string
        }
        
        function selectCsvRow(data_csv, index){
    
            row_csv = data_csv[index]        
            return row_csv
        }
        
        function selectCsvColumn(data_csv, keys, index){
            column_csv = []
            for (i=0; i < data_csv.length; i++){
                object = data_csv[i]
                
                column_csv.push(object[keys[index]])
            } 
            
            return column_csv
        }
        
        
        
        function displayHand(hand_coords, width, height) {
             // Create scales
            var xScale = d3.scaleLinear()
                            .domain(d3.extent(hand_coords, 
                                function(d){
                                    return d[0]; }))
                            .range([0,width]);

            var yScale = d3.scaleLinear()
                    .domain(d3.extent(hand_coords, 
                            function(d){
                                return d[1]; }))
                    .range([height,0]);


            // Create line generator
            var line = d3.line()
                    .y(function(d){return xScale(d[0]);})
                    .x(function(d){return yScale(d[1]);})

            // Create actual path element
            handSvg.append('path')
                .attr('d', line(hand_coords))
                .attr("stroke", "blue")
                .attr("stroke-width", 2)
                .attr("fill", "none");	

            }
            
        
    
        function init() {
            
        pcaSvg = d3.select("#PCA_XY")
        handSvg = d3.select("#handSvg")
        
        d3.text("hands.csv", function(text_hands_csv) { 
            
            keys = create_keys();
            
            //Initialize the input dataset
            new_csv_text = keys + text_hands_csv
            var hands_csv = d3.csvParse(new_csv_text) 

            //Choose the hand and extract its list of coordinates
            keys = d3.keys(hands_csv[0])
            hand = selectCsvRow(hands_csv, 0)

            //Create the list of lists with the coordinates of a hand
            hand_coords = create_hand_coords(hand, keys)
            console.log("Hand coordinates: ")
            console.log(hand_coords)


            //Adjust width and height 
            var width = +handSvg.node().getBoundingClientRect().width;
            var height = +handSvg.node().getBoundingClientRect().height;  
            
            displayHand(hand_coords,width, height)
            
            d3.text("hands_pca.csv", function(text_handsPca_csv) {
                
                //Adjust width and height 
                var width = +pcaSvg.node().getBoundingClientRect().width;
                var height = +pcaSvg.node().getBoundingClientRect().height; 
                var padding = 15
            
                var keys = create_keys();

                //Initialize the PCA dataset
                new_csvPca_text = keys + text_handsPca_csv
                //console.log(new_csvPca_text)
                handsPca_csv = d3.csvParse(new_csvPca_text) 
                //console.log(handsPca_csv)
                var keys = d3.keys(handsPca_csv[0])
            
                first_dimension = selectCsvColumn(handsPca_csv, keys, 0)
                second_dimension = selectCsvColumn(handsPca_csv, keys, 1)
                
                pcaXY_coords = zip([first_dimension, second_dimension])
                console.log(pcaXY_coords)
                
                var X = d3.scaleLinear()
                           .domain(d3.extent(pcaXY_coords,
                                            function(d){
                                              return d[0];
                                            }))
                          .range([ padding , (width - padding) /2]);

                var Y = d3.scaleLinear()
                        .domain(d3.extent(pcaXY_coords,
                                            function(d){
                                              return d[1];
                                            }))
                        .range([(height-padding )/2, padding]);


                pcaSvg.selectAll("circle")
                    .data(pcaXY_coords)
                    .enter()
                    .append("circle")
                    .attr("r", "2px")
                    .attr("cx", function(d){
                                  return ""+X(d[0])+"px";
                                })
                    .attr("cy", function(d){
                                  return ""+Y(d[1])+"px";
                                })
                    .attr("fill", "steelblue")

            });
            
            
            //Temporary part: must insert here the scatter plot of the data
//            point = pcaSvg.append("circle")
//                  .attr("id", "24")
//                  .attr("cx", "10")
//                  .attr("cy", 20)
//                  .attr("fill", "blue")
//                  .attr("r", 10)
//            
//            
//            point.on("click", function() {
//                handSvg.selectAll("*").remove()
//                console.log(this)
//                the_id = this.id
//                hand_csv = selectCsvRow(hands_csv, the_id)
//                //console.log(hand_csv)
//                displayHand(create_hand_coords(hand_csv, keys), width, height)            
            })
            
            
            

        }
        

        
      </script>
    </head>
    <body>
    <svg id="handSvg" style="width : 512px; height: 400px;">
    </svg>
    <svg id="PCA_XY" style="width : 512px; height: 400px;">
    </svg>
    
    
    </body>