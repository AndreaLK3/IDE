<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8"/>
    <style>
      #plotarea1 {
        border:1px solid grey;
      }
      #plotarea2 {
        border:1px solid blue;
      }
      #plotarea1 circle {
        fill:red;
      }
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
        d3.select(window).on('load',init);

        function init() {
  
            d3.csv(
                'Los Angeles Weather Data.csv',
                function(error, raw_data) {
                  if (error) throw error;  

                   var data = raw_data.filter(
                       function(d) 
                        { 
                            if (( parseInt(d.YEAR) >= 1917 ) && ( d.metANN < 990 ) )
                                { return d; } 
                   })
            
        var svg = d3.select('#plotarea1'); 
        //svg.style('width','800px'); in HTMl
        //svg.style('height','400px');
        var width = +svg.node().getBoundingClientRect().width;
        var height = +svg.node().getBoundingClientRect().height;  
            
          var padding = 30;

          var xScale = d3.scaleLinear()
                           .domain(d3.extent(data,
                                            function(d){
                                              return d.YEAR;
                                            }))
                          .range([ padding , width - padding]);

          var yScale = d3.scaleLinear()
              .domain([d3.min(data, 
                              function(d){
                                return d.metANN;
                              }),
                       d3.max(data, 
                              function(d){
                                return d.metANN;
                              })])
              .range([height-padding, padding]);


            d3.select("#plotarea1")
                .selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("r", "5px")
                .attr("cx", function(d){
                              //console.log(d.YEAR)
                              //console.log(""+xScale(d.YEAR))
                              return ""+xScale(d.YEAR)+"px";
                            })
                .attr("cy", function(d){
                              return ""+yScale(d.metANN)+"px";
                            })
            
            for (i=0; i < data.length-1; i++) {
                //console.log(xScale((data[i]).YEAR))
                //console.log(yScale((data[i]).metANN))
                svg.append("line")
                .attr("class", "line")
                .attr("stroke-width","2")
                .attr("stroke","black")
                .attr("x1","" + xScale((data[i]).YEAR)+"px")
                .attr("y1","" + yScale((data[i]).metANN)+"px")
                .attr("x2","" + xScale((data[i+1]).YEAR)+"px")
                .attr("y2","" + yScale((data[i+1]).metANN)+"px");
            }
            //
            
            d3.select('#plotarea1')
              .append('g')            // grouping makes it easy to specify transform
              .attr('transform', 'translate(0,' + (height - padding) + ')')
              .call(d3.axisBottom(xScale).ticks(data.length / 4))           // xAxis will be constructed within selection
            
            d3.select("#plotarea1")
                .append('g')
                .attr('transform', 'translate('+padding+', 0)')
                .call(d3.axisLeft(yScale));
        });
            
        init2();
}
      
</script>
<script>
    function getColors(season){
        color = "#000000";
        switch (season) {
            case "D-J-F" : 
                color = "#00FFFF";
                break;
            case "M-A-M" : 
                color = "#008000";
                break;
            case "J-J-A" : 
                color = "#FFA500";
                break;
            case "S-O-N" :
                color = "#A52A2A";
                break;
        }
        return color;
    }
    
    function init2(){
        d3.csv(
        'Los Angeles Weather Data.csv',
        function(error, raw_data) {
            if (error) throw error;

            var data2 = raw_data.filter(function(d)
                                          {                                      
                                          if (( parseInt(d.YEAR) >= 1917 ) && ( d.metANN < 990 ) &&  ( d["D-J-F"] < 990 ) &&
                                              ( d["M-A-M"] < 990 ) && ( d["J-J-A"] < 990 ) && ( d["S-O-N"] < 990 ) )
                                          { 
                                          return d;
                                          }                                      
                                          })

        var svg_2 = d3.select('#plotarea2');
        //svg.style('width','800px'); in HTMl
        //svg.style('height','400px');
        var width = +svg_2.node().getBoundingClientRect().width;
        var height = +svg_2.node().getBoundingClientRect().height;  
         
         
        var padding = 30;

            
         var xScale = d3.scaleBand().rangeRound([0 + padding, width - padding]).padding(0.03)
                   .domain(data2.map(function(d) { return d.YEAR; }));
             
         var yScale = d3.scaleLinear().rangeRound([height - padding, 0 + padding])
                     .domain([0, d3.max(data2, function(d) { 
                                                return 4 * Math.max(d["D-J-F"], d["M-A-M"], d["J-J-A"], d["S-O-N"]) })]);
            
         //console.log(xScale.domain())
         svg_2.append("g")
              .attr("class", "axis x")
              .attr('transform', 'translate(0,' + (height - padding) + ')')
              .call(d3.axisBottom(xScale).tickValues(xScale.domain().filter(function(d,i){ return !(i%4)}) ) );
              
          console.log(yScale.domain()) 
          svg_2.append("g")
              .attr("class", "axis y")
              .call(d3.axisLeft(yScale).ticks(0))
              .attr('transform', 'translate('+padding+', 0)');
            
        
        //Debug : Equivalent to : d3.stack().keys(keys)(data)
        var stack = d3.stack()
                      .keys(["Year", "D-J-F", "M-A-M", "J-J-A", "S-O-N"])
                      .order(d3.stackOrderNone)
                      .offset(d3.stackOffsetNone);
        var series = stack(data2);
            
        console.log(stack)
        console.log(series)
        // *******************
            
        svg_2.append("g")
             .selectAll("g")
             .data(d3.stack().keys(["Year", "D-J-F", "M-A-M", "J-J-A", "S-O-N"])(data2))
             .enter()
             .append("g")
             .attr("fill", function(d) { return getColors(d.key); })
             .selectAll("rect")
             .data(function(d) { return d; })
             .enter()
             .append("rect")
             .attr("x", function(d) {/*console.log(d.data.YEAR); console.log(d[0]);console.log(d[1]);*/
                                     return xScale(d.data.YEAR); })
             .attr("y", function(d) {console.log(d); return yScale(d[1]); })
             .attr("height", function(d) { return yScale(d[0]) - yScale(d[1]); })
             .attr("width", xScale.bandwidth()); 
   

 
      }
    );
}
      
      
</script>
      
  </head>
    
  <body>
      <h2>IDE : Assignment 2</h2>
      <h3> How has the weather changed over the past 100 years?</h3>
      
      <h4>Los Angeles - average annual temperature</h4>
      <svg width="70%" height="500px" id="plotarea1"></svg>
      
      <svg width="70%" height="500px" id="plotarea2"></svg>   
      
      
      
  </body>
    
</html>
