<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Correlation</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="math.js"></script>
    <script src="Utilities.js"></script>
    <script src="Correlation.js"></script>
    <script>
        d3.select(window).on('load',init)
        
        function drawCorrelationsHistogram(weatherAndStationData){
            
            
        }

        function init() {
            var width = 960,
                height = 500;

            // setup fill color
            // var cValue = function(d) { return d.Manufacturer;},
            color = d3.scaleOrdinal("schemeCategory10");


            // load data
            d3.csv("AndersenBoulevard.csv", function (error, raw_stationdata) {
                
                drawScatterplot("NO2", "CO",width, height, raw_stationdata)
                
                //console.log(raw_stationdata)
                var stationdata = addDateAndTime(raw_stationdata)
                //console.log(stationdata)
                var stationdata = filterDataset(stationdata)
                //console.log(stationdata)
                
                var air_dimensions = Object.keys(stationdata[0]);
                removeFromArray(air_dimensions, "Time")
                removeFromArray(air_dimensions, "Date")
                removeFromArray(air_dimensions, "Timestamp") 
                
                //1console.log(air_dimensions)
                
                d3.csv("WeatherDataset.csv", function(error, raw_weatherdata) {
                    var weatherdata = addDateAndTime(raw_weatherdata)
                    var weatherdata = filterDataset(weatherdata)
                    console.log(weatherdata)
                    
                    prejoin_stationData = d3.nest().key(function(d) {return d.Timestamp})
                                  .rollup(function(arr){return arr[0]}).entries(stationdata)
                    prejoin_weatherData = d3.nest().key(function(d) {return d.Timestamp})
                                  .rollup(function(arr){return arr[0]}).entries(weatherdata)
                    
                    console.log(prejoin_stationData)
                    console.log(prejoin_weatherData)
                    
                    joinedDS  = joinDatasets(prejoin_stationData, prejoin_weatherData,"key")
                    weatherAndStation_data = joinedDS.map(function (elem) {return elem.value})
                
                    console.log(weatherAndStation_data) 
                    
                    var weather_dimensions = Object.keys(weatherdata[0]);
                    removeFromArray(weather_dimensions, "Time")
                    removeFromArray(weather_dimensions, "Date")
                    removeFromArray(weather_dimensions, "Timestamp") 
                    
                    console.log(weather_dimensions)
                    
                    
                    pickedDimension = "NO2"
                    
                    allOtherDims = air_dimensions.concat(weather_dimensions)
                    removeFromArray(allOtherDims, pickedDimension)
                    
                    corrs = []
                    allOtherDims.forEach(function (otherDim) {
                        //console.log(pickedDimension)
                        //console.log(otherDim)
                        corrs.push(
                            {dimension : otherDim, 
                             correlationValue: computeArrayCorrelation(weatherAndStation_data, pickedDimension, otherDim)})
                    } )
                    console.log(corrs)
                    
                    //cc12 = computeArrayCorrelation(weatherAndStation_data, variable1, variable2)
                    //console.log(cc12)
                
                
            
                })
            
                    
            })
            
            
            
        };
    </script>
</head>
<body>

    
    <svg id="forCyclesPivot"></svg>
</body>
</html>