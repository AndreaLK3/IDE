<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>Graph 1: Scatter Plot of Greenhouse Gases</title>
    <style>
      body {
        margin: 0px;
      }
      .domain {
        display: none;
      }
      .tick line {
       stroke: #C0C0BB;
       /*fill: none;*/
      }
      .tick text {
        fill: #8E8883;
        font-size: 8pt;
        font-family: sans-serif;
      }
      .axis-label {
        fill: #635F5D;
        font-size: 16pt;
        font-family: sans-serif;
      }
      .legend {
        text-anchor: middle;
        font-size: 12px;
        font-weight: bold;
      }

      div.tooltip {
        position: absolute;
        text-align: center;
        width: 80px;
        height: 55px;
        padding: 2px;
        font-size: 12px;
        font-family: sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
      }

      .scatterlegend{
        display: inline-block;
        padding: 4px;
        margin: 6px;
      }

      #graph1buttons{
        text-align: center;
      }

    </style>

        <script>
        d3.select(window).on('load',init1)

       function init1() {   
      var parseTime = d3.timeParse("%d/%m/%Y");

      const xValue = d => d.Date;
      const xLabel = 'Dates';
      const yValue = d => d.NOX;
      const yLabel = 'Gases';


      const margin = { left: 120, right: 30, top: 20, bottom: 120 };

      const svg = d3.select('svg');
      const width = svg.attr('width');
      const height = svg.attr('height');
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      const g = svg.append('g')
          .attr('transform', `translate(${margin.left},${margin.top})`);
      const xAxisG = g.append('g')
          .attr('transform', `translate(0, ${innerHeight})`);
      const yAxisG = g.append('g');

      xAxisG.append('text')
          .attr('class', 'axis-label')
          .attr('x', innerWidth / 2)
          .attr('y', 100)
          .text(xLabel);

      yAxisG.append('text')
          .attr('class', 'axis-label')
          .attr('x', -innerHeight / 2)
          .attr('y', -60)
          .attr('transform', `rotate(-90)`)
          .style('text-anchor', 'middle')
          .text(yLabel);

      const xScale = d3.scaleTime();
      const yScale = d3.scaleLinear();
//      const zScale = d3.scaleOrdinal(d3.schemeCategory10);
      var formatTime = d3.timeFormat("%b %e");

      const xAxis = d3.axisBottom()
        .scale(xScale)
        .tickPadding(15)
        .tickSize(-innerHeight);

      const yAxis = d3.axisLeft()
        .scale(yScale)
        .ticks(5)
        .tickPadding(15)
        .tickSize(-innerWidth);

      const row = d => {
        d.Date = parseTime(d.Date);
        d.NOX = +d.NOX;
        return d;
      };

      var div = d3.select("body")
                  .append("div")
                  .attr("class", "tooltip")
                  .style("opacity", 0);

      d3.csv('newAndersenBoulevard.csv', data => {

        var gasNames = d3.keys(data[0])
                     .filter(function(d) { return d !== "Date" && d !== "Time"; })
                     .sort();
        //console.log(gasNames);

        var mapping = gasNames.map(function(mapping) {
          return data.map(function(d) {
            return {key: mapping, time: d.Time, x: parseTime(d.Date), y: +d[mapping]};
          });
        });

        var mapping1 = mapping.map(function(unnamedArray) {
          return {key : unnamedArray[0].key, value: unnamedArray}
        })

        var pointsDisplayed = [];
        gasNames.forEach(function(gas) {
          pointsToAdd = ( mapping1.filter(function(subArray) { if (subArray.key == gas ){return true} else{return false}}) )[0].value
          pointsDisplayed = pointsDisplayed.concat(pointsToAdd)
        })
        //console.log(pointsDisplayed)
        var zScale  = {};
        gasNames.forEach(function(gas, i) {
          zScale[gas] = d3.schemeCategory10[i];
        })
        console.log(d3.schemeCategory10)
        // console.log(mapping);
        // console.log(mapping1);
        console.log(zScale)

        var legends = width/gasNames.length;

        xScale
          .domain(d3.extent(d3.merge(mapping), function(d) { return d.x; }))
          //.domain(d3.extent(data, xValue))
          .range([0, innerWidth])
          .nice();

        yScale
          .domain(d3.extent(d3.merge(mapping), function(d) { return d.y; }))
          //.domain(d3.extent(data, yValue))
          .range([innerHeight, 0])
          .nice();

        selectedGasNames = gasNames.slice();

      
        function updategraph1(selectedGasNames) {

          svg.selectAll('*').remove()
          console.log("Updating Graph1")
          var g1 = svg.append('g')
          .attr('transform', `translate(${margin.left},${margin.top})`)

          const xAxisG1 = g1.append('g')
          .attr('transform', `translate(0, ${innerHeight})`);
      const yAxisG1 = g1.append('g');

          var pointsDisplayed = [];
          selectedGasNames.forEach(function(gas) {
          pointsToAdd = ( mapping1.filter(function(subArray) { if (subArray.key == gas ){return true} else{return false}}) )[0].value
          pointsDisplayed = pointsDisplayed.concat(pointsToAdd)
        })

        pointsDisplayed = pointsDisplayed.filter(function(point) {
          if(point.y == "" || point === undefined) {
            return false;
          }else {
            return true;
          }
        })

yScale.domain(d3.extent(pointsDisplayed, function(d) { return d.y; }))
          //.domain(d3.extent(data, yValue))
          .range([innerHeight, 0])
          .nice();

      xAxisG1.append('text')
          .attr('class', 'axis-label')
          .attr('x', innerWidth / 2)
          .attr('y', 100)
          .text(xLabel);

      yAxisG1.append('text')
          .attr('class', 'axis-label')
          .attr('x', -innerHeight / 2)
          .attr('y', -60)
          .attr('transform', `rotate(-90)`)
          .style('text-anchor', 'middle')
          .text(yLabel);

           xAxisG1.call(xAxis);
         yAxisG1.call(yAxis);

         g1.selectAll(".mapping")
         .data(pointsDisplayed)
         .enter()
         .append("circle")
         .attr("class", "mapping")
         .attr("r", 4.5)
         .attr("cx", function(d) { return xScale(d.x); })
         .attr("cy", function(d) { return yScale(d.y); })
         .style("fill", function(d, i) { return zScale[d.key]; })
         .on("mouseover", function(d) {
              div.transition()
                 .duration(50)
                 .style("opacity", .9);
              div .html(
                 "Date: " + formatTime(d.x) +
                "<br/>"  + "Value: " + d.y +
                "<br/>"  + "Time: " + d.time + 
                "<br/>"  + "Gas: " + d.key)     
         .style("left", (d3.event.pageX) + "px")             
         .style("top", (d3.event.pageY - 28) + "px");

         
       });


      }

          d3.select("#graph1buttons").append("g")
          .selectAll(".scatterlegend")
          .data(selectedGasNames)
          .enter()
          .append("input")
          .attr("type", "button")
          .style("background-color", "lightsteelblue")
          .style("border-color", "black")
          .attr("class", "scatterlegend")
          .attr("value", function (d){return d;})
          .on("click", function(d,i) {
               d3.selectAll(".scatterlegend")
                 .style("background-color", "lightsteelblue")
                 .style("border-color", "black")
        
               d3.select(this)
               .style("background-color", "red")
               .style("border-color", "black")
               selectedGasNames = [d];
               updategraph1(selectedGasNames)})
          
        
        g.selectAll(".mapping")
         .data(pointsDisplayed)
         .enter()
         .append("circle")
         .attr("class", "mapping")
         .attr("r", 4.5)
         .attr("cx", function(d) { return xScale(d.x); })
         .attr("cy", function(d) { return yScale(d.y); })
         .style("fill", function(d, i) { return zScale[d.key]; })
         .on("mouseover", function(d) {
              div.transition()
                 .duration(50)
                 .style("opacity", .9);
              div .html(
                 "Date: " + formatTime(d.x) +
                "<br/>"  + "Value: " + d.y +
                "<br/>"  + "Time: " + d.time + 
                "<br/>"  + "Gas: " + d.key)     
         .style("left", (d3.event.pageX) + "px")             
         .style("top", (d3.event.pageY - 28) + "px");

       });

        g.append("text")
         .attr("x", (innerWidth / 2))             
         .attr("y", 0 - (margin.top / 3))
         .attr("text-anchor", "middle")  
         .style("font-size", "16px") 
         .text("Scatter Plot of Greenhouse Gases");      
       
         xAxisG.call(xAxis);
         yAxisG.call(yAxis);

      });
}
    </script>
  </head>
  <body>
    
    <div><h4>Overview</h4>
    Climate change is an important topic that affects everyone. However, there is little understanding of this topic and there is the tendency to mistake climate change with weather. This article attempts to introduce the residents of Copenhagen to climate change. We present visulizations of some greenhouse gases and the correlation of these gases with weather conditions and phenomenon. <p>The data used was gotten from the Institut for Milj√∏videnskab of the Aarhus University and saved it as CSV file for visualization processing. The visualizations below use a month's worth of data from the 9th of December 2017 to 9th of January 2018</p> </div>
    <br/> 


    <div id=graph1> <svg width="960" height="500"></svg> </div>
    <div id=graph1buttons> </div>
    
  <input id="slider" type="range" min="00:00" max="23:30" value="00:00" step="1"/>
  
  <span id="range">00:00</span>
  </body>
</html>